const isMobileDevice=()=>/Mobi|Android/i.test(navigator.userAgent),racksWrapper=document.getElementById("racks-wrapper"),cart=document.getElementById("cart"),cartRect=cart.getBoundingClientRect(),cartBox=document.getElementById("cart-box"),buyButton=document.getElementById("buy-button");let startItemTop,startItemLeft,currentItem,itemRect,currentImg,touch,deltaY,deltaX,startX=0,startY=0;const makeStartItemPossition=()=>{currentImg.style.left=`${startItemLeft}px`,currentImg.style.top=`${startItemTop}px`,currentItem.style.top="0px",currentItem.style.left="0px"},checkBuyButton=t=>{if(t<=1)return;buyButton.classList.remove("hidden-button"),buyButton.classList.add("buy-button"),buyButton.style.left=cartRect.width/4+"px";const e=setInterval((()=>buyButton.style.opacity="0.5"),500),r=setInterval((()=>buyButton.style.opacity="1"),1e3);setTimeout((()=>clearInterval(e,r)),3e3)},addItemToCart=t=>{cart.appendChild(currentItem),currentItem.style.position="absolute",isMobileDevice()||(currentImg.className=""),currentItem.style.top=cartBox.offsetTop-currentImg.getBoundingClientRect().height+"px",currentItem.style.left=`${cartBox.offsetLeft+t*currentImg.getBoundingClientRect().width/2}px`,currentItem.style.zIndex="0",currentItem.classList.add("cart-item")};function handleStart(t){if(!t.target.classList.contains("item"))return;isMobileDevice()||t.dataTransfer.setData("text/plain",t.target.textContent),currentItem=t.target.closest("picture"),itemRect=currentItem.getBoundingClientRect(),currentImg=t.target,imgRect=currentImg.getBoundingClientRect();const e=currentItem.parentElement.getBoundingClientRect();startItemLeft=imgRect.left-e.left,startItemTop=imgRect.top-e.top,startX=t.touches[0].clientX,startY=t.touches[0].clientY}function handleMove(t){currentItem&&(t.preventDefault(),touch=t.touches[0],deltaX=touch.clientX-startX,deltaY=touch.clientY-startY,currentItem.style.position="absolute",currentItem.style.left=`${Math.floor(deltaX)}px`,currentItem.style.top=`${Math.floor(deltaY)}px`)}function handleEnd(t){if(currentItem)if(touch.clientX-imgRect.width>=cartRect.left&&touch.clientX<=cartRect.right&&touch.clientY+imgRect.height>=cartRect.top&&touch.clientY<=cartRect.bottom){{const t=document.querySelectorAll(".cart-item").length;if(checkBuyButton(t),!(t<=2))return void makeStartItemPossition();addItemToCart(t)}currentImg.className="",currentItem=null}else makeStartItemPossition()}function handleDrop(t){t.preventDefault();const e=document.querySelectorAll(".cart-item").length;checkBuyButton(e),e>2||(addItemToCart(e),currentItem=null)}racksWrapper.addEventListener("dragstart",handleStart),cart.addEventListener("dragover",(t=>{t.preventDefault()})),cart.addEventListener("drop",handleDrop),racksWrapper.addEventListener("touchstart",handleStart),racksWrapper.addEventListener("touchmove",handleMove),racksWrapper.addEventListener("touchend",handleEnd);